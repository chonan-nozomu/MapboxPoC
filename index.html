<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Show and hide layers</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css" rel="stylesheet" />
  <link href="./css/index.css" rel="stylesheet" />
</head>
<body>
  <div id="map"></div>
  <div id="menu">
    <a href="#" id="canvas" class="active" onclick="downloadCanvas();">canvas出力(96dpi)</a>
    <a href="#" id="api" class="active" onclick="downloadStaticImage();">Static Image API</a>
  </div>
  <canvas id="canvas"></canvas>
  <a id="hiddenLink" style="display:none;">link</a>
<!-- directions -->
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css"/>
<!-- geocoder (search)
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css"/>
-->
<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
-->
<!-- jsPDF
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.2.0/jspdf.umd.min.js"></script>
 -->
<!-- html2canvas 
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js"></script>
-->
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiY2hvbmFuLW5vem9tdSIsImEiOiJja2k1bHJjbDg0ZXZ2MnFrem81NWlmaG90In0.v__tuK8SHq9Q2IGKM9ZFwQ';
  var map = new mapboxgl.Map({
    container: "map",
    hash: true,
//      style: "https://gsi-cyberjapan.github.io/gsivectortile-mapbox-gl-js/std.json",
//      style: "./data/gray1moji.json",
    style: "./data/style.json",
    zoom: 13,
    center: [139.753299, 35.685384]
  });
  map.addControl(new mapboxgl.ScaleControl(), "bottom-left");
//  map.addControl(new MapboxGeocoder({accessToken: mapboxgl.accessToken,language: 'ja-JP',mapboxgl: mapboxgl}));
  map.addControl(new mapboxgl.NavigationControl(), 'top-right');
  map.addControl(new MapboxDirections({accessToken: mapboxgl.accessToken}),'top-left');

  
  // 画像ダウンロード
  function downloadCanvas() {
    let canvas = document.getElementById("canvas");
    let link = document.getElementById("hiddenLink");
    link.href = map.getCanvas().toDataURL("image/png");
    link.download="canvas.png"
    link.click();
  }

  // 静的HTMLダウンロード
  function downloadStaticImage() {
    let link = document.getElementById("hiddenLink");
    link.href="https://api.mapbox.com/styles/v1/chonan-nozomu/ckj0qqpqe0uie1arqbobct40r/static/pin-l-z+0000ff(139.75175,35.68551)/139.75175,35.68551,10,0/500x400@2x?access_token=" + mapboxgl.accessToken;
    link.download="image.png";
    link.target="_blank";
    link.click();
    link.target="";
  }
</script>
</body>
</html>
